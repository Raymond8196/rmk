# ELink åè®®é›†æˆè®¡åˆ’

## å½“å‰è¿›åº¦

### âœ… å·²å®Œæˆ

1. **ElinkAdapter æ ¸å¿ƒå®ç°**
   - å®ç°äº†æ¶ˆæ¯ç¼–ç /è§£ç 
   - æ”¯æŒæµå¼å­—èŠ‚å¤„ç†
   - ç¼“å†²åŒºç®¡ç†

2. **PC æµ‹è¯•æ¡†æ¶**
   - `InMemoryTransport`: æ¨¡æ‹ŸåŒå‘é€šä¿¡é€šé“
   - `ElinkTestHarness`: å®Œæ•´çš„æµ‹è¯•ç¯å¢ƒ
   - æ”¯æŒä¸­å¤®å’Œå¤–è®¾è®¾å¤‡æ¨¡æ‹Ÿ

3. **æ€§èƒ½åŸºå‡†æµ‹è¯•**
   - å¯¹æ¯” ELink å’Œ Postcard+COBS
   - æµ‹é‡ç¼–ç /è§£ç é€Ÿåº¦
   - æµ‹é‡ä¼ è¾“å»¶è¿Ÿå’Œååé‡
   - åˆ†æå¸§å¼€é”€

### ğŸš§ è¿›è¡Œä¸­

1. **ElinkSplitDriver å®ç°**
   - å·²å®ç° SplitReader å’Œ SplitWriter trait
   - éœ€è¦è§£å†³ `SplitDriverError` è®¿é—®æƒé™é—®é¢˜ï¼ˆpub(crate)ï¼‰
   - éœ€è¦é›†æˆåˆ° RMK çš„ split æ¨¡å—

### ğŸ“‹ å¾…å®Œæˆ

1. **é›†æˆåˆ° RMK**
   - åœ¨ `rmk/src/split/` ä¸­æ·»åŠ  `elink` æ¨¡å—
   - å®ç° `ElinkSplitDriver` ä½œä¸º RMK çš„ä¸€éƒ¨åˆ†ï¼ˆè§£å†³è®¿é—®æƒé™é—®é¢˜ï¼‰
   - ç¡®ä¿ä¸ç°æœ‰ Serial/BLE é©±åŠ¨å…±å­˜

2. **æ‰©å±•æµ‹è¯•**
   - é”™è¯¯æ¢å¤æµ‹è¯•
   - é«˜è´Ÿè½½æµ‹è¯•
   - è¾¹ç•Œæƒ…å†µæµ‹è¯•
   - é•¿æ—¶é—´è¿è¡Œæµ‹è¯•

3. **ç¡¬ä»¶æµ‹è¯•å‡†å¤‡**
   - ä¸º STM32H7 3x3 pad é”®ç›˜å‡†å¤‡é…ç½®
   - åˆ›å»ºæµ‹è¯•ç”¨ä¾‹

## æ¶æ„è®¾è®¡

### å½“å‰æ¶æ„

```
RMK SplitMessage 
  â†’ Postcard Serialize 
  â†’ ELink StandardFrame 
  â†’ Physical Transport (BLE/Serial)
```

### é›†æˆç‚¹

ELink åè®®åº”è¯¥ä½œä¸º RMK split é€šä¿¡çš„ä¸€ä¸ªé€‰é¡¹ï¼Œç±»ä¼¼äºç°æœ‰çš„ Serial å’Œ BLE é©±åŠ¨ï¼š

```
rmk/src/split/
  â”œâ”€â”€ serial/          # ç°æœ‰ï¼šä¸²å£é©±åŠ¨
  â”œâ”€â”€ ble/             # ç°æœ‰ï¼šBLE é©±åŠ¨
  â””â”€â”€ elink/           # æ–°å¢ï¼šELink é©±åŠ¨
      â”œâ”€â”€ mod.rs       # æ¨¡å—å®šä¹‰
      â”œâ”€â”€ driver.rs    # ElinkSplitDriver å®ç°
      â””â”€â”€ adapter.rs   # åŒ…è£… elink-rmk-adapter
```

## å®æ–½æ­¥éª¤

### æ­¥éª¤ 1: è§£å†³è®¿é—®æƒé™é—®é¢˜

ç”±äº `SplitDriverError` æ˜¯ `pub(crate)` çš„ï¼Œ`ElinkSplitDriver` éœ€è¦ä½œä¸º RMK çš„ä¸€éƒ¨åˆ†å®ç°ï¼Œè€Œä¸æ˜¯åœ¨ `elink-rmk-adapter` ä¸­ã€‚

**æ–¹æ¡ˆ A**: å°† `ElinkSplitDriver` ç§»åˆ° RMK çš„ split æ¨¡å—ä¸­
- ä¼˜ç‚¹ï¼šå¯ä»¥è®¿é—®æ‰€æœ‰å†…éƒ¨ç±»å‹
- ç¼ºç‚¹ï¼šéœ€è¦åœ¨ RMK ä¸­æ·»åŠ  elink-protocol ä¾èµ–

**æ–¹æ¡ˆ B**: åœ¨ `elink-rmk-adapter` ä¸­å®šä¹‰è‡ªå·±çš„é”™è¯¯ç±»å‹ï¼Œç„¶ååœ¨ RMK é›†æˆæ—¶è½¬æ¢
- ä¼˜ç‚¹ï¼šä¿æŒæ¨¡å—ç‹¬ç«‹æ€§
- ç¼ºç‚¹ï¼šéœ€è¦é”™è¯¯ç±»å‹è½¬æ¢

**æ¨è**: æ–¹æ¡ˆ Aï¼Œå› ä¸º ElinkSplitDriver æœ¬è´¨ä¸Šæ˜¯ RMK çš„ä¸€éƒ¨åˆ†ã€‚

### æ­¥éª¤ 2: åœ¨ RMK ä¸­æ·»åŠ  ELink æ”¯æŒ

1. åœ¨ `rmk/Cargo.toml` ä¸­æ·»åŠ  `elink-rmk-adapter` ä¾èµ–
2. åˆ›å»º `rmk/src/split/elink/mod.rs`
3. å®ç° `ElinkSplitDriver`ï¼Œä½¿ç”¨ `elink-rmk-adapter::ElinkAdapter`
4. å¯¼å‡º `ElinkSplitDriver` ä¾›ç”¨æˆ·ä½¿ç”¨

### æ­¥éª¤ 3: åˆ›å»ºç¤ºä¾‹é…ç½®

ä¸º STM32H7 3x3 pad é”®ç›˜åˆ›å»ºä½¿ç”¨ ELink çš„ç¤ºä¾‹é…ç½®ã€‚

## æ€§èƒ½æµ‹è¯•è®¡åˆ’

### æµ‹è¯•æŒ‡æ ‡

1. **å¸§å°è£…/è§£æé€Ÿç‡**
   - ç¼–ç æ—¶é—´ï¼ˆns/æ¶ˆæ¯ï¼‰
   - è§£ç æ—¶é—´ï¼ˆns/æ¶ˆæ¯ï¼‰

2. **æœ€å¤§ä¼ è¾“é€Ÿåº¦**
   - ååé‡ï¼ˆMbpsï¼‰
   - æ¶ˆæ¯/ç§’

3. **ä¼ è¾“å»¶è¿Ÿ**
   - å•ç¨‹å»¶è¿Ÿ
   - å¾€è¿”å»¶è¿Ÿ

4. **å¸§å¼€é”€**
   - ELink å¸§å¤§å° vs åŸå§‹æ¶ˆæ¯å¤§å°
   - ä¸ Postcard+COBS å¯¹æ¯”

### æµ‹è¯•åœºæ™¯

1. **ä½è´Ÿè½½**: 1-10 æ¶ˆæ¯/ç§’
2. **ä¸­è´Ÿè½½**: 10-100 æ¶ˆæ¯/ç§’
3. **é«˜è´Ÿè½½**: 100-1000 æ¶ˆæ¯/ç§’
4. **å³°å€¼è´Ÿè½½**: >1000 æ¶ˆæ¯/ç§’

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… å®Œæˆ ElinkAdapter æ ¸å¿ƒå®ç°
2. âœ… å®Œæˆ PC æµ‹è¯•æ¡†æ¶
3. âœ… å®Œæˆæ€§èƒ½åŸºå‡†æµ‹è¯•
4. ğŸ”„ è§£å†³ ElinkSplitDriver è®¿é—®æƒé™é—®é¢˜
5. â³ é›†æˆåˆ° RMK
6. â³ æ‰©å±•æµ‹è¯•ç”¨ä¾‹
7. â³ ç¡¬ä»¶æµ‹è¯•å‡†å¤‡

## æ–‡ä»¶ç»“æ„

```
elink-protocol/
  â””â”€â”€ elink-rmk-adapter/
      â”œâ”€â”€ src/
      â”‚   â”œâ”€â”€ lib.rs          # å…¬å…±æ¥å£
      â”‚   â”œâ”€â”€ adapter.rs      # ElinkAdapter å®ç°
      â”‚   â”œâ”€â”€ message_mapper.rs # æ¶ˆæ¯æ˜ å°„
      â”‚   â”œâ”€â”€ driver.rs       # ElinkSplitDriverï¼ˆéœ€è¦ç§»åˆ° RMKï¼‰
      â”‚   â””â”€â”€ test_utils.rs   # PC æµ‹è¯•å·¥å…·
      â”œâ”€â”€ examples/
      â”‚   â”œâ”€â”€ pc_test.rs      # åŸºæœ¬æµ‹è¯•
      â”‚   â””â”€â”€ benchmark.rs    # æ€§èƒ½åŸºå‡†æµ‹è¯•
      â””â”€â”€ README.md

rmk/
  â””â”€â”€ src/
      â””â”€â”€ split/
          â””â”€â”€ elink/          # æ–°å¢ï¼šELink é©±åŠ¨
              â”œâ”€â”€ mod.rs
              â””â”€â”€ driver.rs   # ElinkSplitDriverï¼ˆä» elink-rmk-adapter ç§»è¿‡æ¥ï¼‰
```
